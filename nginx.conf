events {
  worker_connections 1024;
  use epoll;
  multi_accept on;
}

http {
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  charset utf-8;
  server_tokens off;

  server {
    listen 80;
    server_name localhost;

    # Кэширование файловых дескрипторов
    open_file_cache max=10000 inactive=30s;
    open_file_cache_valid 60s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;

    # Лимиты для защиты
    client_max_body_size 100M;
    client_body_buffer_size 512k;
    client_body_timeout 60s;

    # Таймауты
    keepalive_timeout 60;
    send_timeout 60;

    # Оптимизация
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    sendfile_max_chunk 1m;

    # serve static
    location /static/ {
      alias /usr/share/nginx/html/;
      try_files $uri =404;
      expires 1y;
      add_header X-Content-Type-Options "nosniff";
      add_header X-Frame-Options "DENY";

      # Видео специфичные настройки
      location ~* \.(mp4|webm|mov|m4v|mkv)$ {
        mp4;
        mp4_buffer_size 2M;
      }
    }
  }
}